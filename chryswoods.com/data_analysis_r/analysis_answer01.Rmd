---
title: "analysis answer"
output:
  html_document:
    df_print: paged
---

```{r}
library(tidyverse)
```

Load the data...

```{r}
temperature <- read_table(
    "https://chryswoods.com/data_analysis_r/cetml1659on.txt",
    skip = 6,
    na = c("-99.99", "-99.9"),
    col_types = cols("DATE" = col_integer())
)
```

Create the month levels

```{r}
month_levels <- c("JAN", "FEB", "MAR", "APR", "MAY", "JUN",
                  "JUL", "AUG", "SEP", "OCT", "NOV", "DEC")
```

Tidy the data...

```{r}
historical_temperature <- temperature |>
    select(-YEAR) |>
    pivot_longer(c("JAN", "FEB", "MAR", "APR", "MAY", "JUN",
                   "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"),
                 names_to = "month",
                 values_to = "temperature",
                 values_drop_na = TRUE) |>
    rename(year = DATE) %>%
    mutate(month = factor(month, month_levels))
```

Calculate the mean monthly temperatures in the 17th Century

```{r}
c17th <- historical_temperature |>
    filter(year < 1700 & year >= 1600) |>
    group_by(month) |>
    summarise("temperature" = mean(temperature))
```

Calculate the mean monthly temperatures in the 21st Century

```{r}
c21st <- historical_temperature |>
    filter(year >= 2000) |>
    group_by(month) |>
    summarise("temperature" = mean(temperature))
```

Now add the difference to the c21st table and print it out

```{r}
c21st <- c21st |>
    full_join(c17th, by = "month", suffix = c(".c21st", ".c17th")) |>
    mutate(change = temperature.c21st - temperature.c17th)
c21st
```

From this we can see that most of the warming is focused on the winter
months.

We will now repeat this for the maximum and minimum temperatures...

```{r}
c17th_max <- historical_temperature |>
    filter(year < 1700 & year >= 1600) |>
    group_by(month) |>
    summarise("temperature" = max(temperature))
c21st_max <- historical_temperature |>
    filter(year >= 2000) |>
    group_by(month) |>
    summarise("temperature" = max(temperature))
c21st_max <-  c21st_max |>
    full_join(c17th_max, by = "month", suffix = c(".c21st", ".c17th")) |>
    mutate(change = temperature.c21st - temperature.c17th)
c21st_max
```

```{r}
c17th_min <- historical_temperature |>
    filter(year < 1700 & year >= 1600) |>
    group_by(month) |>
    summarise("temperature" = min(temperature))
c21st_min <- historical_temperature |>
    filter(year >= 2000) |>
    group_by(month) |>
    summarise("temperature" = min(temperature))
c21st_min <-  c21st_min |>
    full_join(c17th_min, by = "month", suffix = c(".c21st", ".c17th")) |>
    mutate(change = temperature.c21st - temperature.c17th)
c21st_min
```

Finally, we can get the average increase in monthly temperatures by calculating
the mean of the `change` column in `c21st`

```{r}
c21st |> 
    select(change) |>
    pull() |>
    mean()
```

We could alternatively perform all of the calculations to produce a summary table within one dense pipeline, using what we have learnt previously:
```{r}
monthly_summary <- historical_temperature |>
    mutate(century = cut(year, 
                         seq(from = 1600, to = 2100, by = 100), 
                         labels = paste0("c", 17:21), 
                         right = FALSE, 
                         orderd_result = TRUE)
                        ) |>
    filter(century == "c17" | century == "c21") |>
    select(-year) |>
    group_by(century, month) |>
    summarise(mean = mean(temperature), min = min(temperature), max = max(temperature), .groups = 'drop') |>
    pivot_wider(names_from = century, values_from = c(mean, min, max)) |>
    mutate(mean_change = mean_c21 - mean_c17, 
           min_change = min_c21 - min_c17, 
           max_change = max_c21 - max_c17
          )
monthly_summary
```

And use this to calculate the mean change:

```{r}
monthly_summary |>
    summarise(mean_change = mean(mean_change)) |>
    pull()
```